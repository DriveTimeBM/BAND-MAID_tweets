<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BAND-MAID Tweets</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: 20px auto;
      padding: 10px;
    }
    .tweet {
      border-bottom: 1px solid #ccc;
      padding: 10px 0;
    }
    .meta {
      font-size: 0.9em;
      color: #555;
    }
    .tweet-text {
      margin: 5px 0;
    }
    #search {
      width: 100%;
      padding: 8px;
      font-size: 1em;
      margin-bottom: 15px;
    }
    #loadMore {
      display: block;
      margin: 20px auto;
      padding: 10px 20px;
      font-size: 1em;
      cursor: pointer;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/minisearch@6.3.0/dist/umd/index.min.js"></script>
</head>
<body>
  <h1>BAND-MAID Tweets</h1>
  <input type="text" id="search" placeholder="Search tweets...">
  <div id="tweets"></div>
  <button id="loadMore">Load More</button>

  <script>
    const BATCH_SIZE = 100;
    let tweets = [];
    let searchResults = null;
    let renderIndex = 0;

    const tweetsContainer = document.getElementById("tweets");
    const loadMoreBtn = document.getElementById("loadMore");
    const searchInput = document.getElementById("search");

    let miniSearch = new MiniSearch({
      fields: ['Tweet', 'English', 'Member'],
      storeFields: ['DateTimeJST', 'DateTimeGMT', 'TweetId', 'Member', 'Tweet', 'English', 'url']
    });

    // Render one batch
    function renderBatch() {
      const data = searchResults || tweets;
      const slice = data.slice(renderIndex, renderIndex + BATCH_SIZE);

      slice.forEach(t => {
        const div = document.createElement("div");
        div.className = "tweet";
        div.innerHTML = `
          <div class="meta">
            <a href="${t.url}" target="_blank">${t.DateTimeJST}</a> â€” <b>${t.Member}</b>
          </div>
          <div class="tweet-text"><i>${t.Tweet}</i></div>
          <div class="tweet-text">${t.English}</div>
        `;
        tweetsContainer.appendChild(div);
      });

      renderIndex += slice.length;
      if (renderIndex >= data.length) {
        loadMoreBtn.style.display = "none";
      } else {
        loadMoreBtn.style.display = "block";
      }
    }

    // Reset and show first batch
    function resetAndRender(data) {
      tweetsContainer.innerHTML = "";
      renderIndex = 0;
      searchResults = data;
      renderBatch();
    }

    // Event: search
    searchInput.addEventListener("input", () => {
      const q = searchInput.value.trim();
      if (q === "") {
        searchResults = null;
        resetAndRender(tweets);
      } else {
        let results = miniSearch.search(q, { prefix: true, fuzzy: 0.2 });
        results = results.map(r => r);
        resetAndRender(results);
      }
    });

    loadMoreBtn.addEventListener("click", () => {
      renderBatch();
    });

    // Load tweets.json
    fetch("tweets.json")
      .then(r => r.json())
      .then(data => {
        tweets = data;
        miniSearch.addAll(tweets);
        resetAndRender(tweets);
      });
  </script>
</body>
</html>
